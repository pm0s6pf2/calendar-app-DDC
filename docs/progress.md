# Progress Log

## 現在の開発メモ
  現在（2026/01/16）の整理。
  カレンダー表示アプリ本体の機能実装はいったん落ち着いたため、現在は「表示に使うカレンダー画像素材の整備工程」に着手している。
  具体的には、
  ・（済）紙カレンダーのスキャンデータ受領
  ・大量画像ファイルへの一貫した命名ルール付与を目的とした、画像ファイル名一括編集アプリの開発を進めている。

  現在（2025/10/16）の整理。
  chatGPT（（未実施）言語ごとにファイル分け）に「言語ごとにファイルを分ける（HTML / CSS / JavaScript）」を相談し，解決策を提案してもらった。この作業はエラーが多くなると判断し，時間があるときにする予定。gitpagesはフォルダ分け（html/css/js）してもページを表示できるのか確認してから。

## やったこと（Done）
  - **2025-07-05**  
    projects_DDC フォルダを GitHub にアップロード
  - **2025-08-10**  
    表示サンプル画像を作るプログラムを開発し、素材を次の場所に配置  
    `\projects_DDC\materials\calendar_full`
  - **2025-08-10**  
    表示サンプル画像を作るプログラム（`calendar_preview.html`）を開発・実行
  - **2025-08-28**  
    `step1_drive-loader.html` にて Google Drive 連携を達成  
    （ログイン～フォルダID保存まで動作確認済み）
  - **2025-09-09**  
    `step2_show-today.html` にて「今日の画像を表示」機能を実装
  - **2025-09-17**  
    `step3_day-navigator.html`日付ナビゲーション機能（昨日 / 明日 / 昨年 / 来年）を実装
  - **2025-09-19**  
  `step4.1_today-cache.html`キャッシュ機能（今日の分）を実装
  - **2025-09-23**  
  `step4.2_multi-cache.html`先読みキャッシュ機能（今日の分）を実装
  - **2025-09-28**  
  `step4.3_cache-clear.html`キャッシュクリア機能の実装。レイアウトの機微な修正  
  - **2026-01-16**
  カレンダー表示アプリ用の画像素材整備に着手。
  スキャン画像のファイル名変更を自動化するため、ファイル名一括編集アプリの設計・検討を開始。
  - **2026-01-20**
  カレンダー表示アプリ用の画像素材整備に着手。
  スキャン画像のファイル名変更を自動化に成功。
  - **2026-02-11**
  "5. 言語ごとにファイルを分ける（HTML / CSS / JavaScript）" テスト用コードで成功。


  - **今後の予定**  
  - **2025-**  
    `step5_.html`スライドショー機能の実装

## やりたいこと
  - サービス名の案
    - スマホにカレンダー
    - 手元にカレンダー
    - カレンダーを手元に
  - 画面に対して最大表示するボタンの追加
  - ナビゲーションボタンの追加（誕生日，記念日，お気に入り画像）
  - 誕生日，記念日の登録（excelファイル等に記入するようにする？）（メモ（googleスプレッドシーrと管理？）を記録できるようにするのも面白いかも。「この日は何があった」みたいな）
  - スライドショー（数秒ごとに自動切り替え）
  - フォルダ選択UIの改善（ドロップダウン式など、ユーザーが選べるようにする）
  - 「step1_drive-loader.html」の軽微改善案（任意）
    - 現行Step1は「最初のフォルダ」を採用→選択式UIに変更（Step2と同様）。
    - gapi.client.setToken(resp) を追加して、認証後のAPIエラーを減らす。
  - 31日分の日めくりカレンダー（月関係なし）への対応
  - 「google Drive」に保存した画像をスライドショーで表示するアプリを開発する。需要あるのかは不明

共有ドライブ対応のため includeItemsFromAllDrives/supportsAllDrives をONに。

# 画像表示プログラム 開発整理
  ## 📌 開発ロードマップ / Development Roadmap

  ### 1. Google Driveからの画像読み込み
  - **達成**:2025/8/28
  - **開発ファイル**:step1_drive-loader.html
  - **目的 / Goal**: Google Driveから画像を読み込む機能を実装する。  
  - **テスト項目 / Test Points**:
    - GitHub Pages に Step1 をアップして、実機（スマホ/PC）からログイン→フォルダID保存まで確認
      - ユーザーがGoogle Driveにログインできるか？
      - フォルダーを選択し、記憶できるか？
    - 一致するファイル（YYYY-MM-DD.png）のみが一覧表示されるか？
  - **リスク / Risks**:
    - API認証エラー
    - フォルダーの権限問題

  ### 2. 「今日」の画像を表示
  - **達成**:2025/09/09
  - **開発ファイル**:step2_show-today.html
  - **目的 / Goal**: 今日の画像を正しく表示する。  
  - **テスト項目 / Test Points**:
    - 正しいファイル名生成（例: 2025-08-16.png）
    - 画像が欠落した場合の正しいフォールバック
  - **リスク / Risks**:
    - タイムゾーンを越えた日付処理の誤り

  ### 3. ナビゲーションボタン（昨日 / 明日 / 昨年 / 来年）
  - **達成**:2025/09/17
  - **開発ファイル**: step3_day-navigator.html
  - **目的 / Goal**: 日付のナビゲーションをスムーズに実現する。  
  - **テスト項目 / Test Points**:
    - 昨日 / 明日は正しくジャンプする
    - 昨年 / 来年は正しくジャンプする
    - 画像が存在しない場合の適切なフォールバック
  - **リスク / Risks**:
    - 範囲の端のケース（範囲の開始または終了）
    - 年間の巻き戻しエラー

  ### 4. キャッシュ機能
  - **達成**:2025/9/28
  - **開発ファイル** キャッシュの開発ステップごとにファイルを作成して残した。
  - **目的 / Goal**: 閲覧した画像をローカルに保存し、オフラインで使用可能にする。  
  - **テスト項目 / Test Points**:
    - インターネット接続なしでもキャッシュから画像が読み込まれる
    - キャッシュサイズの制御が機能する（例: 最大1～2GB）
  - **リスク / Risks**:
    - スマートフォンでのストレージ不足
    - キャッシュのクリーンアップが正常に機能しない
  
  - **目標 キャッシュ開発ステップ**
    1. 基本キャッシュ
      - **達成**:2025/09/19
      - **開発ファイル**: step4.1_today-cache.html
      - **目的**: 今日表示した画像を保存して、再読み込み時はキャッシュから出す。
      - **補足説明**: 最小限のキャッシュ機能を実装して「オフラインでも最新画像が見える」ことを確認する段階。
      - **実装方式**: Cache API を直接利用。fetch() で取得した画像を caches.put() で保存し、次回アクセス時はキャッシュを優先。

    2. 先読みキャッシュ
      - **達成**:2025/09/23
      - **開発ファイル**: step4.2_multi-cache.html
      - **目的**: 今日を基準に ±3日を取得してキャッシュに入れる。
      - **補足説明**: 「明日 / 昨日」などナビゲーション時の遅延を減らすため、あらかじめ複数日の画像をキャッシュ。スライドショー機能の準備段階でもある。該当する日の画像がなかった時の処理も実装した。
      - **実装方式**: Service Worker + Cache API を組み合わせ、バックグラウンドで先読みを実行。

    3. キャッシュクリア
      - **達成**: 2025/09/28
      - **開発ファイル**: step4.3_cache-clear.html
      - **目的**: 保存されたキャッシュを削除することで、古い画像や不要なデータを消す。
      - **補足説明**: 
          - キャッシュ削除後、表示中の画像も消去
          - 削除確認ダイアログを表示
      - **実装方式**: 
          1. HTML に「キャッシュをクリア」ボタンを追加
          2. JavaScript で `caches.open(CACHE_NAME)` → `cache.keys()` → `cache.delete()` を順に実行
          3. 削除完了後、ステータス表示と `cacheInfo` 更新
          4. `clearImage()` で画面表示をリセット
   
      - **追加の改善案（任意だが推奨）**
        1. ボタンを押したときに進捗を出す
        「削除中…」の表示をしておくと UX が良い。
        2. 大量ファイルのときの時間対策
          キャッシュが大量なら caches.delete(CACHE_NAME) の方が速い（丸ごと削除）。
        3. ログの見栄え
          console.log で成功/失敗を分かりやすく出すとデバッグが楽。
        4. 安全確認
          要らない時は confirm() を削除してカスタムモーダルにした方が見た目が綺麗。

  ### 5. 言語ごとにファイルを分ける（HTML / CSS / JavaScript）
  - **達成**:2025//
  - **開発ファイル**:
  - **目的**:
    - 可読性・保守性の向上（HTML＝構造、CSS＝見た目、JS＝挙動に責務を分離）
    - ブラウザキャッシュによる初回以降の高速化
    - 共同開発・差分レビューが容易に（デザイナー⇄エンジニアの分担が明確）
    - テスト・デバッグしやすく、将来的なモジュール化（PWA化／バンドル）へ滑らかに移行できる
  - **実装方式**:
    - メリット（要点）
      - コードが短く読みやすくなる → バグを見つけやすい
      - CSS/JS が別ファイルならブラウザが個別にキャッシュするため再訪時に速い
      - ファイル単位で linter / formatter を効かせやすい
    - デメリット（注意点）
      - リクエスト数が増える（ただし GitHub Pages は HTTP/2 が有効なら問題になりにくい）
      - スクリプトの読み込み順に注意（Google API の onload が呼ぶ関数がグローバルに存在する必要あり）
  
    - **目標 言語ごとにファイル分けするステップ**
    1. テストファイル
      - **達成**:2026/02/11
      - **開発ファイル**: \WebPlayground\test_pages

  ### 6. 画像最大化機能


  ### 7. スライドショー機能
  - **達成**:2025//
  - **開発ファイル**: step4.4_slideshow-cache.html（仮称）
  - **目的**: キャッシュ済みの範囲を使ってオフラインでもスムーズに切替可能にする。キャッシュ範囲をどれくらいにするか考える。
  - **補足説明**: キャッシュの読み込みを最適化し、スライドショー時に「ロード待ち」が発生しないようにする。キャッシュ済みデータのプリロード戦略を検証。
  - **実装方式**: Service Worker を利用して事前ロード済みデータを即座に返す設計。IndexedDB に「キャッシュ済み日付リスト」を管理するとさらに安定。

  ### 8. 容量管理（LRU方式）
  - **達成**:2025//
  - **開発ファイル**: step4.5_manage-cache.html（仮称）
  - **目的**: キャッシュサイズを 1GB 上限とし、古い画像を削除する。
  - **補足説明**: キャッシュが肥大化してスマホのストレージ不足を招かないように管理。LRU（Least Recently Used）方式で古い画像から削除する。
  - **実装方式**: IndexedDB + Cache API を併用。IndexedDB でファイルの「利用日時メタ情報」を保持し、上限超過時に古いエントリを削除。
    
    ***キャッシュ戦略とスライドショーの関係***
    1. 連続アクセスが高速であること
      - スライドショーは「3秒ごとに次の画像」などになるため、オンライン取得だと毎回APIアクセスが発生して遅い/重い。
      - なので「先読みキャッシュ」が必須。
    2. キャッシュ範囲をどうするか
      - 例: 今日から±7日分を事前にキャッシュしておくと、スライドショーがスムーズ。
      - 将来的にはユーザーが範囲を指定できても良い。
    3.  容量制限と削除ルール
      - 端末ごとに使えるストレージは限られる（スマホは特に厳しい）。
      - 「最近見たN日分だけ保存する」「古いものから削除する」という LRU（Least Recently Used）戦略 が向いています。
    4.  キャッシュの実装方式
      - 第一歩: Service Worker + Cache API
      - → オフラインでもすぐ表示できる。
      - 発展: IndexedDB で画像メタデータも保持（例: キャッシュした日付、フォルダ情報）。

# 📂 画像素材・命名ツール開発（前処理工程）
  ## ⚠️ 今後の検討事項
  - 日めくりカレンダーのスキャンの画

  ## 背景 / 目的
  カレンダー表示アプリでは、画像ファイル名を `YYYY-MM-DD.png` 形式で扱う前提となっている。

  しかし実際の運用では、
  ・紙カレンダーのスキャン画像が大量に発生
  ・スキャン時のファイル名は不規則
  ・手作業でのリネームはミスが起きやすい
  という問題がある。
  そのため、「人が考えなくても正しいファイル名が付く」補助ツールが必要と判断。

  ## 開発したツール
  - PDF_to_png_by_date.html
    - 作成日：2026/01/15
    - 機能
      - カレンダースキャン済みデータ（PDF）をpngファイルに変換する
      - ファイル名は 0001_任意の単語.png のように、4桁連番 + ユーザー入力文字列 で自動生成
    - chatGPTとの会話履歴：https://chatgpt.com/share/6966c743-a000-800a-a325-56415fd81dd5
  - png_calendar_filename_converter.html
    - 作成日：2026/01/15
    - 機能
      - CSV対応表に基づいてファイル名を変換する
    - chatGPTとの会話履歴：https://chatgpt.com/share/6968f4e8-49d0-800a-96ef-ed163b037a64
  - 画像ファイル名変換アプリが用いるcsv対応表作成チャット
    - 作成日：2026/01/15
    - chatGPTとの会話履歴：https://chatgpt.com/share/6968f36d-0c78-800a-994e-608e1a28d448

  ## この工程の位置づけ
  - 本体アプリ開発の「前提条件」を安定させるための基盤整備
  - 将来的な量産・差し替え・再スキャン時の手戻りを防ぐ目的

---
  ## 🔰 基礎的な部分
  - **使用技術**  
    - HTML + CSS + JavaScript（PWA対応）  
    - → スマホとPCの両方で利用可能にするため

  - **ワークフロー**  
    1. ボタンを押す  
    2. 日付を計算 → ファイル名生成  
    3. ローカル/キャッシュを確認  
    4. 見つからなければオンライン取得を試行  
    5. 見つかった場合はキャッシュ保存／見つからなければオーバーレイメッセージ表示  
    6. 最後に読み込んだ画像は表示を維持  

  - **Google Driveアクセス**  
    - 初回使用時にユーザーがフォルダー選択  
    - 選択情報はブラウザストレージ（localStorage / IndexedDB）に保存  

  - **ハイブリッドモード**  
    - ローカル画像でオフライン動作  
    - オンライン取得時はキャッシュに保存して以降オフラインでも利用可能  

  - **キャッシュ戦略（初期）**  
    - 閲覧した画像を自動保存  
    - デフォルトは「3日前〜3日後」の各年度分を推奨  

  - **UIデザイン**  
    - シンプルでレスポンシブ（スマホ・PC対応）  
    - タッチ操作に配慮した大きめのボタン  
    - 表示ボタン例：今日 / 昨日 / 明後日 / 昨年 / 来年

  - **ホスティング方針**  
  - まずは GitHub Pages（無料） で公開。将来必要なら Vercel等 を追加。 
    - 将来、次のような機能を入れたくなったら Vercel を追加検討：
      - サーバ側で画像をまとめて ZIP 化して配布（ブラウザでもできますが、メモリや処理時間が気になる場合はサーバレスへ）

共有APIや簡易DB（KV/Storage）を使いたい

  ---

  ## 🚀 応用的な部分（将来的に追加したい機能や検討した内容など）
  - **画面構成**
    - グーグルドライブにログインする画面とカレンダー表示画面を分けるか否かの検討

  - **画面サイズに合わせた画像表示**
    - 表示している端末がスマホかパソコンかで切り替える予定。可能な限り画像サイズを大きくしたい

  - **スライドショーモード**  
    - 年のみ表示と日付詳細表示を切り替えるトグルボタン  

  - **キャッシュ戦略（拡張）**  
    - ユーザーが範囲を調整可能にする  
    - ローリングキャッシュを保持し、古い画像は削除  
    - キャッシュ制限のユーザー設定：小（30日）、中（90日）、大（1年） 
    - 方式A: Service Worker + Cache Storage（PWA向き・オフライン即時）
    - 方式B: IndexedDB（容量やメタ情報管理がしやすい）
    まずはAで「取得した画像をBlobでキャッシュ→次回はオフラインでも表示」を実装、容量上限（例：1GB）でLRU削除。 

  - **キャッシュ管理（複数カレンダー）**
    - 同一日付に複数のカレンダーが存在する場合のキャッシュ方法を検討
    - 単一キー（日付のみ）では区別できないため，複合キーで管理する案を検討中
      - 例："baseDate::calendarId"の形式で保存

  - **画像フォルダ管理（拡張）**  
    - カレンダー画像を年度ごとにフォルダ分割  
    - 年度フォルダを登録・切り替え可能にする  
    - 階層は「年度フォルダ直下に画像」を推奨
  ---

  ## 💻 開発メモ
  ### HTML / CSS部分
  - **画像表示**  
    - レイアウトシフト対策として `width` と `height` を指定（2025/03/05）  
      - [参考: レイアウトシフト対策](https://moshashugyo.com/media/layout-shift)  
    - センタリング対応（親要素 `div` の height 未指定でも視覚的に中央寄せが可能）（2025/03/05）  
      - [参考1](https://saruwakakun.com/html-css/basic/centering#section2)  
      - [参考2](https://saruwakakun.com/html-css/basic/display)  

  ## 既知の警告（Google API ライブラリ）
    - Chrome の DevTools に以下の警告が表示される：
    - Cross-Origin-Opener-Policy policy would block the window.opener call.
    - 原因：Google 提供の gapi.js 内部処理によるもので、アプリ側コードの問題ではない。
    - 影響：Drive API / Google Identity Services の動作には影響なし。ユーザーにも非表示。
    - 対応方針：無視してよい（修正は Google 側のみ可能）。

  ## ローカルタイムの優先度について（各ユーザーの画面の「日付」の定義について）
    Webアプリはクライアントサイドで動作するので、
    各ユーザーがアクセスしたときに「その端末のローカルタイム」を基準に日付計算を行います。
    つまり：
    東京のユーザー → 日本時間で今日の画像を表示
    ニューヨークのユーザー → ニューヨーク時間で今日の画像を表示
    サーバーを介さずにブラウザだけで動作する場合は、ユーザーごとに別々のローカルタイム基準で表示される形になります。

    もし「全員で同じ日付を共有したい」（例：クラウド上の管理者が「今日は2025-09-05」と決めて全員同じものを見せたい）なら、UTCやサーバー側で日付を統一する仕組みが必要になります。
    でも現状の設計（Google Drive + GitHub Pagesでのフロントエンドアプリ）だと、各ユーザーのローカルタイム基準で動くのが自然です。

## メモ（任意）
- 参考になりそうな動画（他にも類似製品を調べること）
  [ラズベリーパイと電子ペーパーでカレンダーを作る feat Pimoroni Inky Impression](https://www.youtube.com/watch?v=Ai0bTBmrN50)

- プログラムの基礎勉強
  - https://www.figma.com/ja-jp/
  - https://jsgym.shiftb.dev/q?type=JAVA_SCRIPT&level=BASIC&page=10

- 追加したい機能
  - 画像表示機能の強化（ランダム表示など）
  - 設定用のボタンで使えそう
    - https://saruwakakun.com/html-css/basic/display

- 利用するかも。 デザインのソフト
  - https://www.cdata.com/jp/kb/tech/googledrive-odbc-php.rst#Google_Drive_%E3%81%8B%E3%82%89PHP_%E3%81%B8%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E9%80%A3%E6%90%BA%E3%81%AB%E3%81%AF%E3%80%81%E3%81%9C%E3%81%B2CData_ODBC_%E3%83%89%E3%83%A9%E3%82%A4%E3%83%90%E3%82%92%E3%81%94%E5%88%A9%E7%94%A8%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84
  - https://www.figma.com/ja-jp/

- FTPソフト・レンタルサーバーを検討する。参考になりそうなサイト。
  - https://webst8.com/blog/homepage-open-process/#st-toc-h-8
  - https://proengineer.internous.co.jp/content/columnfeature/9391
  - https://www.value-domain.com/media/free-rentalserver/#